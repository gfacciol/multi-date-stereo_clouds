<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Potree Viewer</title>

	<link rel="stylesheet" type="text/css" href="libs/potree/potree.css">
	<link rel="stylesheet" type="text/css" href="libs/jquery-ui/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="libs/perfect-scrollbar/css/perfect-scrollbar.css">
	<link rel="stylesheet" href="libs/openlayers3/ol.css" type="text/css">
	<link rel="stylesheet" href="libs/spectrum/spectrum.css" type="text/css">

   <!-- START - FLIP BUTTON IN POTREE
   - Add style and functions for a button for flipping clouds in potree
   - Copyright (c) 2017, Gabriele Facciolo 
   -->
   <style>
   .potree_flip_toggle{
   	position:		absolute;
   	float:			left;
   	margin:			8px 8px;
   	background:		none;
   	width:			2.5em;
   	height:			2.5em;
   	z-index:		100;
   	top:			calc(2.5em + 8px);
   	cursor: 		pointer;
   }
   </style>
   <script>
      // FLIP FUNCTION
      // finds the first checked point cloud and switches it to the next one
		function potree_flipCloud(viewer) {
			var len = viewer.scene.pointclouds.length
			var index, cur, next;
			for (index = 0; index < len; ++index) {
				if (document.getElementById('scene_list_item_pointcloud_' + index).checked) {
					cur = index;
				}
			}
			next = (cur+1)%len;
         viewer.setDescription(viewer.scene.pointclouds[next].name)
         let x1 = document.getElementById('scene_list_item_pointcloud_' + cur)
         let x2 = document.getElementById('scene_list_item_pointcloud_' + next)
         x2.click()
         x1.click()
		}
		// ADD A CUSTOM FLIP BUTTON TO THE POTREE INTERFACE
      // finds the menu toggle button and adds a new button
      function potree_add_flipButton(viewer) {
         //
			let imgMenuToggle = document.createElement("img");
         //imgMenuToggle.src = new URL(Potree.resourcePath + "/icons/flip.svg").href;
         imgMenuToggle.src = 'data:image/svg+xml;utf8,<svg fill="#ffffff" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 27 24.5" style="enable-background:new 0 0 27 24.5;" xml:space="preserve"><g><path d="M13.276,24.447c0.071,0.035,0.147,0.053,0.224,0.053c0.077,0,0.153-0.018,0.224-0.053c1.566-0.783,4.255-1.197,7.776-1.197   c2.688,0,4.922,0.245,4.945,0.247c0.142,0.017,0.282-0.029,0.389-0.125C26.939,23.278,27,23.142,27,23V6   c0-0.234-0.163-0.438-0.392-0.488C26.572,5.504,26.351,5.456,26,5.387V19.5c0,0.827-0.673,1.5-1.5,1.5   c-0.066,0-6.709,0.031-10.329,1.842c-0.054,0.027-0.114,0.042-0.171,0.061v0c-0.075,0.027-0.151,0.048-0.229,0.066   C13.682,22.985,13.591,23,13.5,23c-0.146,0-0.288-0.028-0.427-0.07c-0.083-0.025-0.167-0.05-0.244-0.088   C9.208,21.031,2.566,21,2.5,21C1.673,21,1,20.327,1,19.5V5.387C0.649,5.456,0.428,5.504,0.392,5.512C0.163,5.563,0,5.766,0,6v17   c0,0.142,0.06,0.278,0.167,0.373c0.106,0.095,0.247,0.141,0.389,0.125C0.578,23.495,2.812,23.25,5.5,23.25   C9.021,23.25,11.71,23.664,13.276,24.447z"/><path d="M15.834,21.145C19.653,20.02,24.442,20,24.5,20c0.276,0,0.5-0.224,0.5-0.5v-17C25,2.224,24.776,2,24.5,2   c-0.106,0-1.096,0.005-2.5,0.109V17.5c0,0.823-0.67,1.496-1.493,1.5C20.399,19.002,18.051,19.091,15.834,21.145z"/><path d="M2.5,20c0.069,0,6.93,0.024,10.776,1.947c0.013,0.007,0.029,0.004,0.042,0.01c0.009,0.004,0.014,0.014,0.023,0.017   C13.394,21.992,13.447,22,13.5,22c0.077,0,0.153-0.018,0.222-0.052c0,0,0.001,0,0.001,0l0-0.001   c0.067-0.034,0.128-0.083,0.176-0.146c0.033-0.044,0.067-0.081,0.1-0.123C16.791,18.068,20.464,18,20.501,18   C20.776,17.999,21,17.775,21,17.5v-17C21,0.224,20.776,0,20.5,0c-0.157,0-3.547,0.05-6.5,3.148V9.5h2v1h-2v5h-1v-5H9v2L6,10l3-2.5   v2h4v-5V3.731C8.898,2.026,2.774,2,2.5,2C2.224,2,2,2.224,2,2.5v17C2,19.776,2.224,20,2.5,20z M13,16.5h1v1h-1V16.5z M13,18.5h1v1   h-1V18.5z"/><rect x="13" y="9.5" width="1" height="1"/></g></svg>';
         imgMenuToggle.onclick = function (){ potree_flipCloud(viewer);};
         imgMenuToggle.classList.add("potree_flip_toggle");
			viewer.renderArea.insertBefore(imgMenuToggle, viewer.renderArea.children[0]);
         // 
         // END ADD A CUSTOM FLIP BUTTON
      }
   </script>
   <!-- END - FLIP BUTTON IN POTREE -->


  </head>

  <body>
  
	<script src="libs/jquery/jquery-3.1.1.js"></script>
	<script src="libs/spectrum/spectrum.js"></script>
	
	<script src="libs/perfect-scrollbar/js/perfect-scrollbar.jquery.js"></script>
	<script src="libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="libs/three.js/build/three.js"></script>
	<script src="libs/other/stats.min.js"></script>
	<script src="libs/other/BinaryHeap.js"></script>
	<script src="libs/tween/tween.min.js"></script>
	<script src="libs/d3/d3.js"></script>
	<script src="libs/proj4/proj4.js"></script>
	<script src="libs/openlayers3/ol.js"></script>
    <script src="libs/i18next/i18next.js"></script>
	
	<script src="libs/potree/potree.js"></script>
 <!--<script src="../src/viewer/sidebar.js"></script>-->

	
	<script src="libs/plasio/js/laslaz.js"></script>
	<script src="libs/plasio/vendor/bluebird.js"></script>

    <div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; ">
		<div id="potree_render_area"></div>
		<div id="potree_sidebar_container"> </div>
    </div>
	
	<script>
	
		window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));
		
		viewer.setEDLEnabled(true);
		viewer.setFOV(60);
		viewer.setPointBudget(1*1000*1000);
		document.title = "";
		viewer.setEDLEnabled(true);
		viewer.setBackground("gradient"); // ["skybox", "gradient", "black", "white"];
		viewer.setDescription(`Training Site`);
		viewer.loadSettingsFromURL();
		

		
		viewer.loadGUI(() => {
			viewer.setLanguage('en');
			$("#menu_scene").next().show();
			//viewer.toggleSidebar();

         var index;
         for (index = 0; index < viewer.scene.pointclouds.length; ++index) {
            viewer.scene.pointclouds[index].material.pointColorType = Potree.PointColorType.ELEVATION;
            viewer.scene.pointclouds[index].material.pointSizeType = Potree.PointSizeType.ATTENUATED;
            viewer.scene.pointclouds[index].material.elevationRange=[18,45];
			}
			
			// ADD A CUSTOM FLIP BUTTON
         potree_add_flipButton(viewer);
			
/*			<!-- MODIFY SIDEBAR TO ADD THE FLIP BUTTON 
         - Add the flip button to the potree sidebar 
         - Copyright (c) 2017, Gabriele Facciolo 
         -->
			let section = $(`
				<h3 id="menu_meta" class="accordion-header ui-widget"><span>Flip Cloud</span></h3>
				<div class="accordion-content ui-widget pv-menu-list"></div>
			`);
			let content = section.last();
			content.html(` <center>
			<a href="#"  id="bottle" onclick="potree_flipCloud(viewer);" >
				<img style="width: 4.5em;" src="libs/potree/resources/icons/flip.svg" alt="bottle" class="thumbnails" />
			</a></center>
			    <!-- Take a look at src/viewer/sidebar.html and sidebar.js to 
				learn how the other sections were populated. -->
			`);
			section.first().click(() => content.slideToggle());
			section.insertBefore($('#menu_classification'));
*/			

		});
		
		Potree.loadPointCloud("pointclouds/g_Z0.ply.gz/cloud.js", "Training Site: gt", e => {
			let pointcloud = e.pointcloud;
			let material = pointcloud.material;
			viewer.scene.addPointCloud(pointcloud);
			material.pointColorType = Potree.PointColorType.ELEVATION; // any Potree.PointColorType.XXXX 
			material.size = 1;
			material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
			material.shape = Potree.PointShape.SQUARE;
			viewer.fitToScreen();
			e.pointcloud.visible = false;
		});
		
		
		Potree.loadPointCloud("pointclouds/g_rs0_fu_heNEW_N700_med.ply.gz/cloud.js", "Training Site: median 700", e => {
			let pointcloud = e.pointcloud;
			let material = pointcloud.material;
			viewer.scene.addPointCloud(pointcloud);
			material.pointColorType = Potree.PointColorType.ELEVATION; // any Potree.PointColorType.XXXX 
			material.size = 1;
			material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
			material.shape = Potree.PointShape.SQUARE;
			viewer.fitToScreen();
			e.pointcloud.visible = false;
		});

		Potree.loadPointCloud("pointclouds/g_rs0_fu_heNEW_N47_med.ply.gz/cloud.js", "Training Site: median 50", e => {
			let pointcloud = e.pointcloud;
			let material = pointcloud.material;
			viewer.scene.addPointCloud(pointcloud);
			material.pointColorType = Potree.PointColorType.ELEVATION; // any Potree.PointColorType.XXXX 
			material.size = 1;
			material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
			material.shape = Potree.PointShape.SQUARE;
			viewer.fitToScreen();
			e.pointcloud.visible = false;
		});		
		
		Potree.loadPointCloud("pointclouds/g_rs0_fu_heNEW_N47_kmedianslow.ply.gz/cloud.js", "Training Site: k-medians 50", e => {
			let pointcloud = e.pointcloud;
			let material = pointcloud.material;
			viewer.scene.addPointCloud(pointcloud);
			material.pointColorType = Potree.PointColorType.ELEVATION; // any Potree.PointColorType.XXXX 
			material.size = 1;
			material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
			material.shape = Potree.PointShape.SQUARE;
			viewer.fitToScreen();
			e.pointcloud.visible = true;
		});
				
	</script>
	
	
  </body>
</html>
